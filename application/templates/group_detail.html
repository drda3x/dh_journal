{% extends "base.html" %}
{% load i18n %}
{% block style%}
    <link rel="stylesheet" href="/static/css/group_detail.css">
    <style>
        .profitgood {
         background-color: #33ff99 !important;
         }
         .profitbad {
         background-color: #fc4e3a !important;
         }
         .profitnormal {
         background-color: #9aceeb !important;
         }

         {% for typ in passes_color_classes%}
             .{{typ.name}} { background-color: {{typ.val}}; }
         {% endfor %}

    </style>

    <script type="text/javascript" src="/static/js/matrix.js"></script>
    <script type="text/javascript" src="/static/js/popover.js"></script>
{% endblock %}
{% block script %}
    <script type="text/javascript" src="../static/js/group_detail.js"></script>

    <script type="text/javascript">

        (function() {
            "use strict";

            app.controller("GroupCtrl", ["$scope", function($scope) {
                $scope.data = {{group_detail | safe}};

                $scope.getProfit = function(val) {
                    if(val < 0) {
                        return 'profitbad';
                    } else if(val > 0) {
                        return 'profitgood';
                    } else {
                        return 'profitnormal';
                    }
                };
                
                $scope.column = null;
                $scope.columnClick = function(index) {
                    if ($scope.row == null) {
                        $scope.column = index;
                    }
                }

                $scope.hoveredColumn = null;
                $scope.columnIndexCache = function(index) {
                    $scope.hoveredColumn = index;
                }

                $scope.hoveredRow = null;
                $scope.rowIndexCache = function(index) {
                    $scope.hoveredRow = index;
                }

                $scope.row = null;
                $scope.rowClick = function(index) {
                    if ($scope.column == null) {
                        $scope.row = index;
                    }
                }

            }]); 
        })();
    </script>
{% endblock %}
{% block content %}
            {% verbatim %}
    <div class="span10 well" ng-controller="GroupCtrl">
        <div class="row-fulid">
            <div ng-class="{span4: column!=null}" >
                <table class="table table-bordered region" ng-mouseleave="columnIndexCache(null)">
                    <tr>
                        <th>Фамилия Имя</th>
                        <th ng-repeat="date_rec in data.calendar" ng-click="columnClick($index)" ng-show="column == null || column==$index" ng-class="getProfit(date_rec.profit)">{{date_rec.date}}</th>
                    </tr>
                    <tr ng-repeat="student in data.students" ng-mouseover="rowIndexCache($index)" ng-show="row == null || row == $index" ng-init="rowIndex=$index">
                        <td ng-dblclick="rowClick($index)" ng-mouseover="columnIndexCache(null);" ng-class="{highlight: hoveredRow==rowIndex}">{{student.person.last_name}} {{student.person.first_name}}</td>
                        <td ng-class="{highlight: !column && (hoveredColumn==$index || hoveredRow==rowIndex)}" 
                            ng-mouseover="columnIndexCache($index)" 
                            ng-click="columnClick($index)" 
                            ng-show="column == null || column==$index" class="{{lesson.color}}" 
                            ng-repeat="lesson in student.calendar track by $index">
                            <strong ng-show="column==null">{{lesson.sign}}</strong>
                            <a href="" ng-show="column!=null && !lesson.pass">Добавить оплату</a>
                            <input type="checkbox" ng-show="column!=null && lesson.pass" />
                        </td>
                    </tr>
                </table>
            </div>
            <div class="span6" ng-show="column!=null">
                <div class="row-fulid day-buttons">
                  <div class="span7">
                  <button class="btn btn-danger">Отменить занятие</button>
                  <button class="btn btn-primary" ng-click="columnClick(null)">Вернуться к ведомости</button>
                  </div>
                </div>
                <div class="row-fulid day-buttons">
                  <div class="span7">
                    <button class="btn btn-success">Сохранить и проставить пропуски</button>
                    <button class="btn btn-primary">Сохранить без пропусков</button>
                  </div>
                </div>
                <div class="row-fulid day-buttons">
                  <div class="span7">
                    <button class="btn btn-danger">Удалить все отметки</button>
                  </div>
                </div>
            </div>
        </div>
    </div>
            {% endverbatim %}
{% endblock %}
